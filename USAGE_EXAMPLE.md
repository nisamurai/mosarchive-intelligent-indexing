# Пример использования конструктора отчёта

## Быстрый старт

Этот документ показывает, как использовать конструктор отчёта для экспорта данных из обработанных документов.

## Пример данных

Предположим, у вас есть массив документов после обработки:

```javascript
const data = [
  { 
    fund: 1, 
    opis: 2, 
    delo: 3, 
    fio: 'Иванов И.И.', 
    date: '01.01.2000',
    documentNumber: '№ 123',
    fileName: 'document1.pdf',
    archiveCode: '01-0203-0745-000002'
  },
  { 
    fund: 5, 
    opis: 10, 
    delo: 7, 
    fio: 'Петрова А.С.', 
    date: '15.03.1924',
    documentNumber: 'акт-456',
    fileName: 'document2.tiff',
    archiveCode: '01-0203-0745-000007'
  }
];
```

## Экспорт в CSV

### 1. Простой экспорт

```javascript
// Используем готовую функцию экспорта
exportToCSV(data, ['fund','opis','delo','fio','date']);
```

**Результат CSV:**
```csv
Фонд,Опись,Дело,ФИО,Дата
1,2,3,"Иванов И.И.",01.01.2000
5,10,7,"Петрова А.С.",15.03.1924
```

### 2. Расширенный экспорт

```javascript
exportToCSV(data, [
  'fileName', 
  'archiveCode', 
  'fund', 
  'opis', 
  'delo', 
  'fio', 
  'date', 
  'documentNumber'
]);
```

**Результат CSV:**
```csv
Имя файла,Архивный шифр,Фонд,Опись,Дело,ФИО,Дата,Номер документа
document1.pdf,"01-0203-0745-000002",1,2,3,"Иванов И.И.",01.01.2000,№ 123
document2.tiff,"01-0203-0745-000007",5,10,7,"Петрова А.С.",15.03.1924,акт-456
```

## Использование в веб-интерфейсе

### Переход к конструктору отчёта

1. Откройте главную страницу приложения
2. оккнопку **"Перейти к конструктору отчёта"**
3. Выберите нужные поля из предложенных категорий

### Выбор полей

**Основная информация:**
- ☑️ Имя файла
- ☑️ Дата обработки  
- ☑️ Размер файла
- ☐ Статус обработки

**Атрибуты документа:**
- ☑️ Фонд
- ☑️ Опись
- ☑️ Дело
- ☑️ ФИО
- ☑️ Дата
- ☐ Номер документа
- ☐ Адрес
- ☐ Организация

**Текстовая информация:**
- ☐ Полный текст документа

### Быстрые шаблоны

| Кнопка | Выбранные поля |
|--------|----------------|
| **Основная информация** | Имя файла, Дата обработки, Размер файла, Статус |
| **Архивные атрибуты** | Фонд, Опись, Дело, ФИО, Дата, Номер документа |
| **С полным текстом** | Имя файла, Распознанный текст, Дата обработки |
| **Полный архивный** | Все архивные поля + базовые |

### Предварительный просмотр

Система показывает примерную структуру отчёта в виде таблицы с заголовками и образцами данных.

## Формат вывода

### Структура CSV файла

1. **Заголовки** - русские названия полей в первой строке
2. **Данные** - значения для каждого документа в отдельных строках
3. **Экранирование** - корректная обработка символов согласно RFC 4180
4. **Кодировка** - UTF-8 с BOM для Excel

### Пример формируемых строки CSV

```javascript
// Для каждого документа создаётся строка вида:
'"document1.pdf","01-0203-0745-000002",1,2,3,"Иванов И.И.",01.01.2000'

// Примеры экранирования:
// Простое значение: Иванов
// Со специальными символами: "Иванов, Иван Иванович"
// С кавычками: "'Важные" данные'"
```

## Система адаптации данных

### Автоматическое преобразование

Приложение автоматически адаптирует данные из различных источников:

```javascript
// Из UploadComponent
const adaptedFromUpload = adaptFileWithProgress(fileWithProgress);

// Из App.tsx (ProcessedFile)
const adaptedFromApp = адамиProcessedFile(processedFile);

// Тестовые данные для демонстрации
const sampleData = createSampleData(5);
```

### Расширение данных

```javascript
import { extendDocumentData } from './lib/documentDataAdapter';

const enrichedData = extendDocumentData(document, {
  organization: 'Государственный архив РФ',
  status: 'Проверен',
  processingDate: new Date().toLocaleString('ru-RU')
});
```

## Обработка результатов

### Статистика экспорта

После экспорта получаете информацию:

```javascript
{
  fileName: 'archive_report_2024-03-15T10-30-45.csv',
  rowsCount: 5,              // Количество документов
  columnsCount: 6,           // Количество полей
  exportedFields: ['Фонд', 'Опись', 'Дело', 'ФИО', 'Дата', 'Имя файла']
}
```

### Уведомления пользователя

```javascript
// Успешный экспорт
alert(`Отчёт успешно экспортирован!
Экспортировано ${result.rowsCount} документов 
с полями: ${result.exportedFields.join(', ')}`);

// Ошибки
if (selectedFields.length === 0) {
  alert('Выберите поля для экспорта и убедитесь, что есть данные документов');
}
```

## Интеграция с существующими компонентами

### В главном приложении

```typescript
// App.tsx
const handleOpenReport = () => {
  setCurrentState('report');
};

// Кнопка для открытия конструктора отчёта
<button onClick={handleOpenReport}>
  Перейти к конструктору отчёта
</button>
```

### Получение данных для отчёта

```typescript
const getReportData = () => {
  // Если есть обработанные файлы
  if (processedFiles.length > 0) {
    return processedFiles.map(адамиProcessedFile);
  }
  
  // Если нет - используем тестовые данные
  return createSampleData(5);
};

<ReportConstructor documents={getReportData()} />
```

## Расширенные возможности

### Пакетный экспорт

```javascript
// Экспорт нескольких отчётов
const templates = [
  { name: 'brief', fields: FIELD_TEMPLATES.basic },
  { name: 'archive', fields: FIELD_TEMPLATES.archiveAttributes },
  { name: 'full', fields: FIELD_TEMPLATES.archiveFull }
];

templates.forEach(template => {
  exportToCSV(data, template.fields, template.name);
});
```

### Фильтрация данных

```javascript
import { filterDocuments } from './lib/documentDataAdapter';

// Фильтр по фонду
const fond10 = filterDocuments(documents, { fund: [10] });

// Фильтр по статусу
const processedOnly = filterDocuments(documents, { 
  status: ['Обработан', 'Проверен'] 
});

// Фильтр по дате
const recentDocs = filterDocuments(documents, {
  dateFrom: new Date('2024-01-01'),
  dateTo: new Date()
});
```

### Сортировка данных

```javascript
import { sortDocuments } from './lib/documentDataAdapter';

// Сортировка по дате
const sortedByDate = sortDocuments(documents, 'date', 'desc');

// Сортировка по фонду
const sortedByFond = sortDocuments(documents, 'fund', 'asc');
```

## Заключение

Конструктор отчёта предоставляет полный набор инструментов для работы с данными документов:

✅ **Гибкий выбор полей** - любые комбинации из доступных
✅ **Готовые шаблоны** - быстрое создание отчётов
✅ **Предварительный просмотр** - контроль структуры данных
✅ **Корректный экспорт** - совместимость с Excel и другими программами
✅ **Простая интеграция** - работа с существующими компонентами
✅ **Русская локализация** - корректное отображение кириллицы

Система готова к использованию и может быть легко расширена новыми полями и функциями.
