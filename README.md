#  MosArchive Intelligent Indexing | Сервис извлечения и индексирования информации из образов архивных документов

Веб-сервис с применением средств искусственного интеллекта для автоматизированного извлечения данных из образов архивных документов, их индексирования и наполнения базы данных.

> Код проекта спецально обогащён комментариями для быстрого погружения в суть реализации

## Технологии

- **Frontend**: React 19 + TypeScript
- **Backend**: Python
- **Сборщик**: Vite
- **Стили**: Tailwind CSS
- **Иконки**: Lucide React
- **Пакетный менеджер**: Bun

## Установка и запуск

1. Перейдите в директорию проекта:
```bash
cd mosarchive-intelligent-indexing
```

2. Установите зависимости:
```bash
bun install
```

3. Запустите сервер разработки (выберите один из вариантов):

**Вариант 1 (рекомендуется):**
```bash
bunx vite
```

**Вариант 2 (через скрипт):**
```bash
bun run dev
```

**Вариант 3 (альтернативный порт):**
```bash
bunx vite --port 3000
```

4. Откройте браузер и перейдите по адресу:
   - `http://localhost:5173` (стандартный порт)
   - `http://localhost:3000` (если используете альтернативный порт)

## Компонент UploadComponent

### Описание

React-компонент для загрузки документов с поддержкой:
- Drag-and-drop интерфейса
- Выбора одиночных и множественных файлов
- Валидации форматов (JPG, JPEG, TIFF, PDF)
- Прогресс-бара загрузки
- Обработки ошибок

### Использование

```tsx
import UploadComponent from './components/UploadComponent';

function App() {
  const handleUpload = (files: File[]) => {
    console.log('Загружены файлы:', files);
    // Ввызов ИИ для обработки документов
  };

  return (
    <UploadComponent 
      onUpload={handleUpload}
      maxFiles={20}
      maxFileSize={100 * 1024 * 1024} // 100MB
    />
  );
}
```

### Пропсы

- `onUpload: (files: File[]) => void` - callback функция, вызываемая после загрузки файлов
- `maxFiles?: number` - максимальное количество файлов (по умолчанию 10)
- `maxFileSize?: number` - максимальный размер файла в байтах (по умолчанию 50MB)
- `className?: string` - дополнительные CSS классы

### Состояние компонента

```typescript
interface FileWithProgress {
  file: File;           // Исходный файл
  id: string;           // Уникальный идентификатор
  progress: number;     // Прогресс загрузки (0-100)
  status: 'pending' | 'uploading' | 'completed' | 'error';
  error?: string;       // Сообщение об ошибке
}
```

### Обработчики событий

- `handleDragOver` - обработка перетаскивания над зоной
- `handleDragLeave` - обработка выхода из зоны перетаскивания
- `handleDrop` - обработка сброса файлов
- `handleFileSelect` - обработка выбора файлов через input
- `handleFiles` - основная логика обработки файлов
- `removeFile` - удаление файла из списка
- `handleUpload` - запуск процесса загрузки

## Структура проекта

```
src/
├── components/
│   ├── UploadComponent.tsx    # Основной компонент загрузки
│   └── VerifyPage.tsx        # Компонент верификации результатов
├── lib/
│   ├── image_processing.py    # Модуль предобработки изображений
│   ├── attribute_recognition.py # Модуль атрибутивного распознавания
│   └── utils.ts              # Утилиты (cn функция для Tailwind)
├── App.tsx                   # Главный компонент приложения
├── main.tsx                  # Точка входа
└── index.css                 # Глобальные стили

documentation/
├── README_image_processing.md      # Документация модуля обработки изображений
├── README_attribute_recognition.md # Документация модуля атрибутивного распознавания
└── README_verification_module.md   # Документация модуля верификации результатов
requirements.txt              # Python зависимости для модуля обработки
```

## Особенности реализации

1. **Валидация файлов**: Проверка формата и размера файлов
2. **Прогресс-бар**: Визуализация процесса загрузки и обработки
3. **Обработка ошибок**: Понятные сообщения об ошибках
4. **Верификация результатов**: Интерактивный интерфейс для проверки и редактирования распознанного текста
5. **Синхронизация состояния**: Автоматическое сохранение изменений между компонентами
6. **Управление ресурсами**: Оптимизация памяти через автоматическую очистку URL объектов
7. **Адаптивный дизайн**: Работает на всех устройствах
8. **Accessibility**: 
   - Поддержка клавиатурной навигации (Tab, Enter, Пробел, Escape)
   - ARIA-атрибуты для скрин-ридеров
   - Семантическая разметка
   - Focus-индикаторы для кнопок
   - Альтернативный текст для изображений

## Модуль предобработки изображений

Проект включает Python модуль для предобработки изображений документов с заглушками функций:
- Выравнивание (deskew)
- Коррекция контрастности
- Шумоподавление
- Бинаризация
- Коррекция перспективы
- Улучшение разрешения

**[Подробная документация модуля](documentation/README_image_processing.md)**

## Модуль атрибутивного распознавания

Система извлечения структурированных метаданных из текста архивных документов:
- ФИО, даты, адреса
- Архивные шифры
- Номера документов, организации
- Подсветка найденных атрибутов в UI

**[Подробная документация модуля](documentation/README_attribute_recognition.md)**

**Модуль верификации результатов**

Система для проверки и коррекции распознанного текста:
- Интерактивный просмотр изображений документов 
- Редактирование распознанного текста с валидацией
- Подсветка изменений и статистические данные
- Автоматическая синхронизация с состоянием приложения

**[Подробная документация модуля](documentation/README_verification_module.md)**

## Компонент VerifyPage

### Описание

React-компонент для верификации результатов распознавания текста с возможностью редактирования. Предоставляет интуитивный интерфейс для проверки и корректировки текста, распознанного из архивных документов.

### Основные возможности

- **Интерактивное превью документа**: Масштабирование, поворот, скачивание изображения
- **Редактирование распознанного текста**: Режимы просмотра и редактирования
- **Валидация изменений**: Контроль корректности внесенных правок
- **Подсветка изменений**: Визуальное выделение отредактированных участков
- **Синхронизация состояния**: Автоматическое сохранение изменений в приложении
- **Управление памятью**: Редукция памяти через автоматическую очистку blob URL

### Использование

```tsx
import VerifyPage from './components/VerifyPage';

function App() {
  const handleSaveVerification = async (editedText: string) => {
    // Сохранение результатов верификации
    console.log('Сохранен текст:', editedText);
  };

  const handleCancelVerification = () => {
    // Отмена верификации
    console.log('Верификация отменена');
  };

  return (
    <VerifyPage
      imageUrl="blob:http://localhost:5173/abc123..."
      recognizedText="Распознанный текст документа..."
      fileName="document.pdf"
      onSave={handleSaveVerification}
      onCancel={handleCancelVerification}
    />
  );
}
```

### Пропсы

```typescript
interface VerifyPageProps {
  imageUrl: string;              // URL изображения документа
  recognizedText: string;        // Распознанный текст для верификации
  fileName?: string;             // Имя файла документа
  onSave?: (editedText: string) => Promise<void>; // Callback сохранения
  onCancel?: () => void;        // Callback отмены
  className?: string;           // Дополнительные CSS классы
}
```

### Состояние компонента

```typescript
interface TextValidationInfo {
  hasChanges: boolean;           // Есть ли изменения в тексте
  originalLength: number;        // Длина исходного текста
  editedLength: number;          // Длина отредактированного текста
  validationErrors: string[];    // Ошибки валидации
}
```

### Инструменты работы с изображением

| Функция | Описание | Горячая клавиша |
|---------|----------|-----------------|
| **Увеличить** | Масштабирование изображения на 20% | Ctrl + колесико мыши вверх |
| **Уменьшить** | Масштабирование изображения на 20% | Ctrl + колесико мыши вниз |
| **Повернуть** | Поворот изображения на 90° | Кнопка "Повернуть" |
| **Скачать** | Скачивание изображения документа | Кнопка "Скачать" |
| **Сброс масштаба** | Возврат к исходному масштабу | Wheel без Ctrl |

### Режимы работы

#### 🔍 Режим просмотра
- Отображение текста с подсветкой изменений
- Предварительный просмотр с невозможностью редактирования
- Показ статистики по тексту (количество символов, изменения)

#### ✏️ Режим редактирования
- Полнофункциональный текстовый редактор
- Автоматический фокус на текстовом поле
- Валидация изменений в реальном времени
- Кнопки "Сохранить" и "Отмена"

### Валидация текста

Компонент выполняет следующие проверки:

```typescript
// Примеры валидационных правил
const validationRules = {
  emptyText: 'Текст не может быть пустым',
  tooShort: 'Текст стал значительно короче оригинала (< 50%)',
  tooLong: 'Текст стал значительно длиннее оригинала (> 200%)'
};
```

### Архитектура компонента

```
VerifyPage
├── ImageToolbar          # Панель инструментов изображения
├── ImageViewer          # Область просмотра изображения
├── TextEditor           # Редактор текста
├── HighlightedText      # Подсветка изменений
└── ValidationPanel      # Панель валидации
```

### Подкомпоненты

#### ImageToolbar
```tsx
interface ImageToolbarProps {
  onZoomIn: () => void;      // Увеличение изображения
  onZoomOut: () => void;     // Уменьшение изображения
  onRotate: () => void;      // Поворот изображения
  onDownload: () => void;    // Скачивание изображения
  zoomLevel: number;         // Текущий уровень масштаба
}
```

#### HighlightedText
```tsx
interface HighlightedTextProps {
  originalText: string;      // Исходный текст
  editedText: string;        // Отредактированный текст
  className?: string;        // CSS классы
}
```

### Интеграция с приложением

Компонент полностью интегрирован в основное приложение:

1. **Переключение состояния**: Автоматический переход между режимами загрузки (`upload`) и верификации (`verify`)

2. **Синхронизация данных**: Измененный текст сохраняется в состоянии `processedFiles`

3. **Управление памятью**: 
   ```tsx
   // Создание URL для отображения
   const imageUrl = URL.createObjectURL(file);
   
   // Очистка памяти после использования
   URL.revokeObjectURL(imageUrl);
   ```

4. **Обработчики состояния**:
   ```tsx
   const handleVerifyFile = (processedFile: ProcessedFile) => {
     setVerifyFile(processedFile);
     setImageUrl(URL.createObjectURL(processedFile.file));
     setCurrentState('verify');
   };
   ```

### Стилизация и UX

- **Tailwind CSS** для консистентного дизайна
- **Цветовая схема**: Серый/синий для основных элементов, желтый для изменений
- **Анимации**: Плавные переходвы для лучшего UX
- **Responsive design**: Адаптация под разные размеры экрана

### Производительность

- **Мемоизация**: Использование `useCallback` для оптимизации рендеринга
- **Ленивая загрузка**: Изображения загружаются только при необходимости
- **Очистка ресурсов**: Автоматическая очистка blob URL объектов

### Доступность (Accessibility)

- **ARIA-атрибуты**: Описания для скрин-ридеров
- **Клавиатурная навигация**: Поддержка Tab, Enter, Escape
- **Focus-индикаторы**: Визуальные указатели активных элементов
- **Семантическая разметка**: Правильное использование HTML-тегов

### Установка Python зависимостей

```bash
pip install -r requirements.txt
```

## Заглушки для ИИ

В текущей версии все вызовы ИИ заменены заглушками:
- Загрузка файлов симулируется с задержкой
- Обработка документов выводится в консоль
- В будущем здесь будут реальные вызовы API ИИ

## Сборка для продакшена

```bash
bun run build
```

Собранные файлы будут в папке `dist/`.