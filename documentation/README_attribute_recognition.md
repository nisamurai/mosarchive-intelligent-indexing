# Атрибутивное распознавание документов

Модуль для извлечения структурированных метаданных из текста архивных документов.

## Функционал

### Основная функция: `extract_attributes(text)`

Извлекает следующие атрибуты из текста:
- **ФИО** - имена, фамилии, отчества
- **Даты** - в различных форматах (ДД.ММ.ГГГГ, ДД/ММ/ГГГГ)
- **Адреса** - географические локации
- **Архивные шифры** - коды фондов, описей, дел
- **Номера документов** - идентификаторы документов
- **Организации** - названия учреждений

## Использование

```python
from src.lib.attribute_recognition import extract_attributes

# Пример текста
text = "Дело №123 Фонд 10, опись 5, дело 20. Иванов И.И. 05.04.1960. Архивный шифр: XX/1234."

# Извлечение атрибутов
attributes = extract_attributes(text)
print(attributes)
```

### Ожидаемый результат:

```
Извлекаем атрибуты из текста...
{
    'fio': 'Иванов И.И.',
    'date': '05.04.1960', 
    'address': '',
    'archive_code': 'Фонд 10, опись 5, дело 20, XX/1234',
    'document_number': 'Дело №123',
    'organization': ''
}
```

### Пример с настоящим архивным шифром:

```python
text = "Документ содержит архивный шифр 01-0203-0745-000002 и дату 15.03.2024."
attributes = extract_attributes(text)
print(attributes)
```

**Результат:**
```
{
    'fio': '',
    'date': '15.03.2024',
    'address': '',
    'archive_code': '01-0203-0745-000002',
    'document_number': '',
    'organization': ''
}
```

## Дополнительные функции

### `extract_attributes_with_positions(text)`

Извлекает атрибуты с указанием их позиций в тексте для подсветки в UI:

```python
from src.lib.attribute_recognition import extract_attributes_with_positions

attributes_with_positions = extract_attributes_with_positions(text)
```

### `validate_extracted_attributes(attributes)`

Проверяет корректность извлеченных атрибутов:

```python
from src.lib.attribute_recognition import validate_extracted_attributes

validation_results = validate_extracted_attributes(attributes)
```

### `highlight_text_with_attributes(text, attributes_with_positions)`

Создает HTML-разметку с цветовой подсветкой найденных атрибутов:

```python
from src.lib.attribute_recognition import highlight_text_with_attributes

highlighted_html = highlight_text_with_attributes(text, attributes_with_positions)
```

## Цветовая схема подсветки

- **ФИО**: Красный (#ff6b6b)
- **Даты**: Бирюзовый (#4ecdc4)  
- **Адреса**: Синий (#45b7d1)
- **Архивные шифры**: Зеленый (#96ceb4)
- **Номера документов**: Желтый (#feca57)
- **Организации**: Розовый (#ff9ff3)

## Интеграция с UI

Модуль интегрирован в компонент загрузки файлов (`UploadComponent.tsx`):

1. После распознавания текста автоматически запускается извлечение атрибутов
2. Показывается прогресс извлечения с фиолетовой цветовой схемой
3. Результаты отображаются в структурированном виде с подписями полей
4. Поддерживается отображение как атрибутов, так и исходного распознанного текста

## Алгоритмы (планируемые для реализации)

Текущая версия использует регулярные выражения. В будущем планируется добавить:

1. **Named Entity Recognition (NER)** с использованием spaCy или transformers
2. **Машинное обучение** для извлечения именованных сущностей
3. **Контекстный анализ** для определения типов данных
4. **Валидация** по справочникам и базам данных
5. **Извлечение дополнительных атрибутов**: телефоны, email, суммы, валюты

## Регулярные выражения

### ФИО
- `[А-ЯЁ][а-яё]+\s+[А-ЯЁ]\.[А-ЯЁ]\.` - Формат "Иванов И.И."
- `[А-ЯЁ][а-яё]+\s+[А-ЯЁ][а-яё]+\s+[А-ЯЁ][а-яё]+` - Полное ФИО

### Даты
- `\d{1,2}\.\d{1,2}\.\d{4}` - ДД.ММ.ГГГГ
- `\d{1,2}\/\d{1,2}\/\d{4}` - ДД/ММ/ГГГГ

### Архивные коды
- `\d{2}-\d{4}-\s*\d{4}-\d{6}` - Архивные шифры типа "01-0203-0745-000002"
- `[А-ЯЁ]{1,3}\/\d+` - Шифры типа "XX/1234"
- `Фонд\s+\d+` - Номера фондов
- `опись\s+\d+` - Номера описей
- `дело\s+\d+` - Номера дел

### Номера документов  
- `Дело\s*№\s*\d+` - "Дело №123"
- `№\s*\d+` - "№123"

## Запуск тестов

```bash
python src/lib/attribute_recognition.py
```

Тестирует извлечение атрибутов на нескольких примерах и выводит результаты с подсветкой.
