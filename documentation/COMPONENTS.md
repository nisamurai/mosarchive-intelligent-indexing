# Компоненты системы

## UploadComponent

### Описание

React-компонент для загрузки документов с поддержкой:
- Drag-and-drop интерфейса
- Выбора одиночных и множественных файлов
- Валидации форматов (JPG, JPEG, TIFF, PDF)
- Прогресс-бара загрузки
- Обработки ошибок

### Использование

```tsx
import UploadComponent from './components/UploadComponent';

function App() {
  const handleUpload = (files: File[]) => {
    console.log('Загружены файлы:', files);
    // Вызов ИИ для обработки документов
  };

  return (
    <UploadComponent 
      onUpload={handleUpload}
      maxFiles={20}
      maxFileSize={100 * 1024 * 1024} // 100MB
    />
  );
}
```

### Пропсы

- `onUpload: (files: File[]) => void` - callback функция, вызываемая после загрузки файлов
- `maxFiles?: number` - максимальное количество файлов (по умолчанию 10)
- `maxFileSize?: number` - максимальный размер файла в байтах (по умолчанию 50MB)
- `className?: string` - дополнительные CSS классы

### Состояние компонента

```typescript
interface FileWithProgress {
  file: File;           // Исходный файл
  id: string;           // Уникальный идентификатор
  progress: number;     // Прогресс загрузки (0-100)
  status: 'pending' | 'uploading' | 'completed' | 'error';
  error?: string;       // Сообщение об ошибке
}
```

### Обработчики событий

- `handleDragOver` - обработка перетаскивания над зоной
- `handleDragLeave` - обработка выхода из зоны перетаскивания
- `handleDrop` - обработка сброса файлов
- `handleFileSelect` - обработка выбора файлов через input
- `handleFiles` - основная логика обработки файлов
- `removeFile` - удаление файла из списка
- `handleUpload` - запуск процесса загрузки

## VerifyPage

### Описание

React-компонент для верификации результатов распознавания текста с возможностью редактирования. Предоставляет интуитивный интерфейс для проверки и корректировки текста, распознанного из архивных документов.

### Основные возможности

- **Интерактивное превью документа**: Масштабирование, поворот, скачивание изображения
- **Редактирование распознанного текста**: Режимы просмотра и редактирования
- **Валидация изменений**: Контроль корректности внесенных правок
- **Подсветка изменений**: Визуальное выделение отредактированных участков
- **Синхронизация состояния**: Автоматическое сохранение изменений в приложении
- **Управление памятью**: Редукция памяти через автоматическую очистку blob URL

### Использование

```tsx
import VerifyPage from './components/VerifyPage';

function App() {
  const handleSaveVerification = async (editedText: string) => {
    // Сохранение результатов верификации
    console.log('Сохранен текст:', editedText);
  };

  const handleCancelVerification = () => {
    // Отмена верификации
    console.log('Верификация отменена');
  };

  return (
    <VerifyPage
      imageUrl="blob:http://localhost:5173/abc123..."
      recognizedText="Распознанный текст документа..."
      fileName="document.pdf"
      onSave={handleSaveVerification}
      onCancel={handleCancelVerification}
    />
  );
}
```

### Пропсы

```typescript
interface VerifyPageProps {
  imageUrl: string;              // URL изображения документа
  recognizedText: string;        // Распознанный текст для верификации
  fileName?: string;             // Имя файла документа
  onSave?: (editedText: string) => Promise<void>; // Callback сохранения
  onCancel?: () => void;        // Callback отмены
  className?: string;           // Дополнительные CSS классы
}
```

### Состояние компонента

```typescript
interface TextValidationInfo {
  hasChanges: boolean;           // Есть ли изменения в тексте
  originalLength: number;        // Длина исходного текста
  editedLength: number;          // Длина отредактированного текста
  validationErrors: string[];    // Ошибки валидации
}
```

### Инструменты работы с изображением

| Функция | Описание | Горячая клавиша |
|---------|----------|-----------------|
| **Увеличить** | Масштабирование изображения на 20% | Ctrl + колесико мыши вверх |
| **Уменьшить** | Масштабирование изображения на 20% | Ctrl + колесико мыши вниз |
| **Повернуть** | Поворот изображения на 90° | Кнопка "Повернуть" |
| **Скачать** | Скачивание изображения документа | Кнопка "Скачать" |
| **Сброс масштаба** | Возврат к исходному масштабу | Wheel без Ctrl |

### Режимы работы

#### Режим просмотра
- Отображение текста с подсветкой изменений
- Предварительный просмотр с невозможностью редактирования
- Показ статистики по тексту (количество символов, изменения)

#### Режим редактирования
- Полнофункциональный текстовый редактор
- Автоматический фокус на текстовом поле
- Валидация изменений в реальном времени
- Кнопки "Сохранить" и "Отмена"

### Валидация текста

Компонент выполняет следующие проверки:

```typescript
// Примеры валидационных правил
const validationRules = {
  emptyText: 'Текст не может быть пустым',
  tooShort: 'Текст стал значительно короче оригинала (< 50%)',
  tooLong: 'Текст стал значительно длиннее оригинала (> 200%)'
};
```

### Архитектура компонента

```
VerifyPage
├── ImageToolbar          # Панель инструментов изображения
├── ImageViewer          # Область просмотра изображения
├── TextEditor           # Редактор текста
├── HighlightedText      # Подсветка изменений
└── ValidationPanel      # Панель валидации
```

### Подкомпоненты

#### ImageToolbar
```tsx
interface ImageToolbarProps {
  onZoomIn: () => void;      // Увеличение изображения
  onZoomOut: () => void;     // Уменьшение изображения
  onRotate: () => void;      // Поворот изображения
  onDownload: () => void;    // Скачивание изображения
  zoomLevel: number;         // Текущий уровень масштаба
}
```

#### HighlightedText
```tsx
interface HighlightedTextProps {
  originalText: string;      // Исходный текст
  editedText: string;        // Отредактированный текст
  className?: string;        // CSS классы
}
```

### Интеграция с приложением

Компонент полностью интегрирован в основное приложение:

1. **Переключение состояния**: Автоматический переход между режимами загрузки (`upload`) и верификации (`verify`)

2. **Синхронизация данных**: Измененный текст сохраняется в состоянии `processedFiles`

3. **Управление памятью**: 
   ```tsx
   // Создание URL для отображения
   const imageUrl = URL.createObjectURL(file);
   
   // Очистка памяти после использования
   URL.revokeObjectURL(imageUrl);
   ```

4. **Обработчики состояния**:
   ```tsx
   const handleVerifyFile = (processedFile: ProcessedFile) => {
     setVerifyFile(processedFile);
     setImageUrl(URL.createObjectURL(processedFile.file));
     setCurrentState('verify');
   };
   ```

### Стилизация и UX

- **Tailwind CSS** для консистентного дизайна
- **Цветовая схема**: Серый/синий для основных элементов, желтый для изменений
- **Анимации**: Плавные переходы для лучшего UX
- **Responsive design**: Адаптация под разные размеры экрана

### Производительность

- **Мемоизация**: Использование `useCallback` для оптимизации рендеринга
- **Ленивая загрузка**: Изображения загружаются только при необходимости
- **Очистка ресурсов**: Автоматическая очистка blob URL объектов

### Доступность (Accessibility)

- **ARIA-атрибуты**: Описания для скрин-ридеров
- **Клавиатурная навигация**: Поддержка Tab, Enter, Escape
- **Focus-индикаторы**: Визуальные указатели активных элементов
- **Семантическая разметка**: Правильное использование HTML-тегов
